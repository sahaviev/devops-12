# 11.01 Введение в микросервисы

## Задача 1: Интернет-магазин

Руководство крупного интернет-магазина у которого постоянно растёт пользовательская база и количество заказов рассматривает возможность переделки своей внутренней ИТ системы на основе микросервисов. 

Вас пригласили в качестве консультанта для оценки целесообразности перехода на микросервисную архитектуру. 

Опишите какие выгоды может получить компания от перехода на микросервисную архитектуру и какие проблемы необходимо будет решить в первую очередь.

---

**Ответ**:

С 2013 по 2018 год я работал backend-разработчиком в одном очень крупном и популярном по сей день в России интернет-магазине по доставке цветов.
Тогда микросервисная архитектура только начинала становиться мейнстримом, во всяком случае у нас ее не было.
Хотя частично один модуль я полностью реализовал в виде REST-микросервиса и он очень гибко вписался в архитектуру.

Декомпозиция это то что нужно делать при переходе на микросервисную архитектуру.

#### Примеры микросервисов которые могли бы быть в интернет-магазине цветов:

1. Frontend с nginx
2. Товары, расчет цены и доставки
3. Загрузка и обработка изображений
4. Фильтры (сложная система, которая учитывает пересечения разных свойств товаров, их доставку в города и скрывает недоступные свойства динамически) 
5. Обмен данными с бухгалтерией и складом
6. Интеграция с маркетинговыми инструментами
7. Логирование событий 

### +++ микросервисной архитектуры:

#### Масштабируемость команды разработки

Микросервисная архитектура предполагают взаимодействие разных 
[слабо зацепленных](https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D1%86%D0%B5%D0%BF%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)) между собой модулей. 
Что позволит разделить их по разным командам, каждой команде спокойно работать над каким-то модулем, зная что изменения в нем не
затронут напрямую другие модули. Каждый микросервис это только часть крупной системы, при наличии документации(да и без нее)
с этим сервисом будет намного легче разобраться и работать, чем со всей монолитной системой целиком.
Это в разы уменьшает порог вхождения других разработчиков и позволяет распределять задачи между специалистами разных уровней.

#### Масштабируемость системы

Здесь я подразумеваю реально возможную и более дешевую горизонтальную масштабируемость.
В случае монолита это может быть дороже и не так просто, если вообще возможно.
В интернет-магазине был функционал по получению списка товаров, расчета стоимости каждого товара, определения доставки в конкретный город и т.д.
Это была самая сложная составляющая с большим количеством кода и при этом часто вызываемая.
В сезон пиковой нагрузки имело бы смысл выделить побольше реплик только на этот сервис, в случае монолита у нас были 
мощные реплики всего web'а.

#### Упрощения процесса поставки

Сервисы обычно выполняют конкретную задачу, они намного меньше чем монолитное приложение.
Современное разделение на микросервисы позволяет обновлять конкретные модули не затрагивая другие, при этом само обновление
будет незаметным с нулевым временем недоступности сервисов.

#### Упрощения процесса разработки

Я уже выше писал о том что микросервисы это часть системы, дополню здесь то что можно легко работать над разными сервисами
параллельно, на практике, хоть зависимость между ними и есть, вероятность возникновения конфликтов в системе контроля версия
становится минимальна.
Можно отдельной командой разработать какую-от новую фичу, протестировать, задеплоить и, с минимальными усилиями, 
подключить к системе и так же легко отключить, если она перестала быть нужной.

### --- микросервисной архитектуры:

#### Стоимость перехода на микросервисную архитектуру

Для того чтобы перейти на микросервисную архитектуру нужны значительные усилия и технические лидеры или devops-инженеры,
которые могут организовать инфрастуктуру для микросервисной архитектуры.
Как минимум разработчиком нужно разбить монолитное приложение на модули, что скорее всего повлечет переписывания всей
системы. В случае проектов которые развивались в монолитной архитектуре в течение 20 лет - это может быть очень долго
и как следствие дорого, не каждый бизнес может себе это позволить.

#### Взаимодействие сервисов между собой 

Общение между ними даже внутри одной сети сложнее и дороже чем исполнение кода внутри монолита.
Поэтому необходимо иметь баланс между сервисами.

#### Дополнительные расходы на мониторинг

В монолитном приложении гораздо проще смотреть нагрузку на серверах и предпринимать какие-то действия.
Это могут быть пара web-серверов и пара сервером баз данных, а в микросервисной архитектуре та же система
может исчисляться десятками и сотнями отдельных сервисов. 
Для того чтобы мониторить микросервисы нужно внедрять дополнительные инструменты для автоматизации.

#### Сложнее тестирование

Относительно небольшой минус, но все же сначала нужно протестировать измененные сервисы по отдельности,
а затем провести регрессионное тестирование всей системы.

---

Все из личного опыта. Тянет на небольшую статью =)