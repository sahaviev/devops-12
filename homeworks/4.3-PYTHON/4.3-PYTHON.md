# 4.3. 4.3. Языки разметки JSON и YAML

### 1. Мы выгрузили JSON, который получили через API запрос к нашему сервису:

```json
{ "info" : "Sample JSON output from our service\t",
    "elements" :[
        { "name" : "first",
        "type" : "server",
        "ip" : 7175 
        },
        { "name" : "second",
        "type" : "proxy",
        "ip : 71.78.22.43
        }
    ]
}
```

Нужно найти и исправить все ошибки, которые допускает наш сервис

Ответ:
```json
{
	"info": "Sample JSON output from our service\t",
	"elements": [{
			"name": "first",
			"type": "server",
			"ip": 7175
		},
		{
			"name": "second",
			"type": "proxy",
			"ip": "71.78.22.43"
		}
	]
}
```

### 2. Доработка скрипта из предыдущего задания

В прошлый рабочий день мы создавали скрипт, позволяющий опрашивать веб-сервисы и получать их IP.
К уже реализованному функционалу нам нужно добавить возможность записи JSON и YAML файлов,
описывающих наши сервисы. Формат записи JSON по одному сервису: { "имя сервиса" : "его IP"}.
Формат записи YAML по одному сервису: - имя сервиса: его IP. Если в момент исполнения скрипта
меняется IP у сервиса - он должен так же поменяться в yml и json файле.

Ответ:

```python
#!/usr/bin/env python3

import socket
import yaml
import json


def save_service_to_txt(filename, _services):
    with open(filename, 'w') as f:
        for hostname in _services:
            f.write(f'{hostname} - {_services[hostname]}\n')


def save_to_yml(filename, data):
    with open(filename, 'w') as f:
        f.write(yaml.dump(data, indent=4, explicit_start=True))


def save_to_json(filename, data):
    with open(filename, 'w') as f:
        f.write(json.dumps(data, indent=4))


def load_services_from_txt(filename):
    _services = {}
    with open(filename, 'r') as f:
        for data in f:
            check = data.split(' - ')
            _services[check[0]] = check[1].strip()
    return _services


def check_services(_services):
    for hostname in _services:
        current_ip = socket.gethostbyname(hostname)
        if current_ip != _services[hostname]:
            print(f'[ERROR] {hostname} IP mismatch: {_services[hostname]} {current_ip}')
            _services[hostname] = current_ip
        else:
            print(f'{hostname} - {current_ip}')
    return _services


services = check_services(load_services_from_txt('services-list.txt'))

save_service_to_txt('services-list.txt', services)
save_to_yml('services-list.yml', services)
save_to_json('services-list.json', services)

```