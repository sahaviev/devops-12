# 5.4. 5.4. Оркестрация группой Docker контейнеров на примере Docker Compose

## Задача 1

Создать собственный образ операционной системы с помощью Packer.

Для получения зачета, вам необходимо предоставить:
- Скриншот страницы, как на слайде из презентации (слайд 37).

Инициализация Yandex.Cloud

```commandline
➜  5.4-DOCKER-COMPOSE git:(master) ✗ yc init
Welcome! This command will take you through the configuration process.
Pick desired action:
 [1] Re-initialize this profile 'default' with new settings
 [2] Create a new profile
Please enter your numeric choice: 1
Please go to https://oauth.yandex.ru/authorize?response_type=token&client_id=_____client_id_____ in order to obtain OAuth token.

Please enter OAuth token: [b1g40**********je92n] _____token_____
You have one cloud available: 'cloud-netology' (id = _____cloud-id_____). It is going to be used by default.
Please choose folder to use:
 [1] default (id = _____cloud-id_____)
 [2] Create a new folder
Please enter your numeric choice: 1
Your current folder has been set to 'default' (id = _____folder-id_____).
Do you want to configure a default Compute zone? [Y/n] Y
Which zone do you want to use as a profile default?
 [1] ru-central1-a
 [2] ru-central1-b
 [3] ru-central1-c
 [4] Don't set default zone
Please enter your numeric choice: 1
Your profile default Compute zone has been set to 'ru-central1-a'.
```

Конфигурация Yandex.Cloud

```commandline
➜  5.4-DOCKER-COMPOSE git:(master) ✗ yc config list
token: _____token_____
cloud-id: _____cloud-id_____
folder-id: _____folder-id_____
compute-default-zone: ru-central1-a
```

Создание сети в Yandex.Cloud

```commandline
➜  5.4-DOCKER-COMPOSE git:(master) ✗ yc vpc network create \
> --name net \
> --labels my-label=netology \
> --description "my first network via yc"

id: _____network-id______
folder_id: _____folder-id_____
created_at: "2022-01-07T12:11:00Z"
name: net
description: my first network via yc
labels:
  my-label: netology
```

Создание подсети в Yandex.Cloud

```commandline
➜  5.4-DOCKER-COMPOSE git:(master) ✗ yc vpc subnet create \
> --name my-subnet-a \
> --zone ru-central1-a \
> --range 10.1.2.0/24 \
> --network-name net \
> --description "my first subnet via yc"

id: _____subnet-id_____
folder_id: _____folder-id_____
created_at: "2022-01-07T12:13:29Z"
name: my-subnet-a
description: my first subnet via yc
network_id: enp7badt4kg8b1nonbdm
zone_id: ru-central1-a
v4_cidr_blocks:
- 10.1.2.0/24
```

Записываем в конфигурацию для packer **packer/centos-7-base.json**:
1. _____token_____
2. _____subnet-id_____
3. _____folder-id_____

Проверяем конфигурационный файл packer'a:

```commandline
➜  5.4-DOCKER-COMPOSE git:(master) ✗ packer validate packer/centos-7-base.json
The configuration is valid.
```

Запускаем packer и создаем образ виртуальной машины в Yandex.Cloud:

```commandline
➜  5.4-DOCKER-COMPOSE git:(master) ✗ packer build packer/centos-7-base.json
yandex: output will be in this color.

==> yandex: Creating temporary ssh key for instance...
...
...
...
==> yandex: Creating image: centos-7-base
==> yandex: Waiting for image to complete...
==> yandex: Success image create...
==> yandex: Destroying boot disk...
    yandex: Disk has been deleted!
Build 'yandex' finished after 1 minute 58 seconds.

==> Wait completed after 1 minute 58 seconds

==> Builds finished. The artifacts of successful builds are:
--> yandex: A disk image was created: centos-7-base (id: fd8vpeleismau6kv1u2f) with family name centos
➜  5.4-DOCKER-COMPOSE git:(master) ✗ yc compute image list
+----------------------+---------------+--------+----------------------+--------+
|          ID          |     NAME      | FAMILY |     PRODUCT IDS      | STATUS |
+----------------------+---------------+--------+----------------------+--------+
| fd8vpeleismau6kv1u2f | centos-7-base | centos | f2elksrop9ucs73ts3me | READY  |
+----------------------+---------------+--------+----------------------+--------+
```

![Packer Build Example](assets/packer-build-example.png)


## Задача 2

Создать вашу первую виртуальную машину в Яндекс.Облаке.

Для получения зачета, вам необходимо предоставить:
- Скриншот страницы свойств созданной ВМ



## Задача 3

Создать ваш первый готовый к боевой эксплуатации компонент мониторинга, состоящий из стека микросервисов.

Для получения зачета, вам необходимо предоставить:
- Скриншот работающего веб-интерфейса Grafana с текущими метриками

## Задача 4 (*)

Создать вторую ВМ и подключить её к мониторингу развёрнутому на первом сервере.

Для получения зачета, вам необходимо предоставить:
- Скриншот из Grafana, на котором будут отображаться метрики добавленного вами сервера.

