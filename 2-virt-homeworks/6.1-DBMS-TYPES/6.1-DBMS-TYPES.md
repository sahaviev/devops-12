# 6.1. Типы и структура СУБД

### Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

* Электронные чеки в json виде
* Склады и автомобильные дороги для логистической компании
* Генеалогические деревья
* Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
* Отношения клиент-покупка для интернет-магазина

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

---

Ответ:

> **Электронные чеки в json виде** - документо-ориентированную СУБД MongoDB - она хранит данные в виде JSON.

> **Склады и автомобильные дороги для логистической компании** - я думаю графовые СУБД
([GraphDB](https://graphdb.ontotext.com/documentation/standard/about-graphdb.html)) лучше всего подойдут для хранения 
таких данных, но они очень специфичны. 
В свое время(2010-2013 году я работал на проекте с картами) маршруты и объекте на карте мы хранили в реляционной 
СУБД Oracle. Поэтому скорее всего выбор падет либо на PostgreSQL.

> **Генеалогические деревья** - [GraphDB](https://graphdb.ontotext.com/documentation/standard/about-graphdb.html)

> **Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации** - для это цели я буду использовать 
Redis. Он идеально подходит под задачи кеширования данных с определенным ttl(time-to-life).

> **Отношения клиент-покупка для интернет-магазина** - реляционные СУБД типа MySQL идеально подходят для хранения данных
>интернет-магазинов.

### Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно CAP-теореме. 
Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

* Данные записываются на все узлы с задержкой до часа (асинхронная запись)
* При сетевых сбоях, система может разделиться на 2 раздельных кластера
* Система может не прислать корректный ответ или сбросить соединение

А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

---

Ответ:

#### По CAP-теореме 

> **Данные записываются на все узлы с задержкой до часа (асинхронная запись)** - по CAP-теореме это считается 
доступная система, поэтому
> 1. CA - данные доступны и согласованы: например, СУБД с одним инстансом
> 2. AP - данные доступны и устойчивы к разделению, но не согласованы в каждый момент времени

> **При сетевых сбоях, система может разделиться на 2 раздельных кластера** - данные на разных серверах могут быть разные,
отсутствует согласованность, поэтому это AP-система

> **Система может не прислать корректный ответ или сбросить соединение** - это, скорее всего, CP-система в которой в случае
сбоя запросы могут теряться.

#### По PACELC-теореме

> **Данные записываются на все узлы с задержкой до часа (асинхронная запись)** 
> 1. PA/EC - данные доступны, но не согласованы для всех узлов если они есть / либо согласованы и доступны если всего 1 узел  
> 2. PA/EL - данные доступны, но не согласованы для всех узлов если они есть / либо не согласованы, но идут с минимальной задержкой

> **При сетевых сбоях, система может разделиться на 2 раздельных кластера** - PA/EL

> **Система может не прислать корректный ответ или сбросить соединение** - PC/EC

### Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

---

Ответ: 

> Не может потому что это 2 противоположных друг другу принципа.
>  
> 1. Основная цель принципа ACID добиться согласованности данных в угоду доступности/производительности.
> 2. Основная цель принципа BASE добиться высокой доступности/производительности в угоду согласованности данных.
> 
> Думаю, в лучшем случае можно построить систему, которая будет иметь какой-то процент допустимых отклонений. 
> 
> В зависимости от требований бизнеса будут определяться основные принципы и используемые инструменты. 


### Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

* фиксация некоторых значений с временем жизни
* реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). Что это за система? Какие минусы выбора данной системы?

---

Ответ: 

> Кажется в решении данной задачи поможет Redis. 
> * **фиксация некоторых значений с временем жизни** - это обычная установка ключей с ttl. 
> * **реакция на истечение таймаута** - это подписка на канал где будут сообщения с информацией о ключах, которые истекли.
> 
> [Redis 2.8 - Notifications.](https://redis.io/topics/notifications)